<!-- navbar.html -->
{% with current_view=request.resolver_match.url_name %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
<link rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.2.4/js/bootstrap.min.js"></script>



<nav class="navbar navbar-expand-lg bg-primary" data-bs-theme="dark">
  <div class="container-fluid d-flex align-items-center">
    <a class="navbar-brand {% if current_view == 'index' %}active{% endif %}" href="{% url 'index' %}">DbWebApp</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarColor01">
      <div class="d-flex align-items-center flex-grow-1">
        {% if user.is_superuser %}
        <div class="scroll-container d-flex align-items-center me-3">
          <button id="scrollLeft" class="scroll-button">&lt;</button>
          <div class="navbar-nav-wrapper">
            <ul id="navList" class="navbar-nav me-auto">
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'TirList' %}active{% endif %}" href="{% url 'TirList' %}?sort_by=id_tir&sort_order=ASC">Tir</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'JobList' %}active{% endif %}" href="{% url 'JobList' %}?sort_by=id_job&sort_order=ASC">Job</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'ListAngajat' %}active{% endif %}" href="{% url 'ListAngajat' %}?sort_by=id_angajat&sort_order=ASC">Angajat</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'ListPoarta' %}active{% endif %}" href="{% url 'ListPoarta' %}?sort_by=id_poarta&sort_order=ASC">Poarta</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'ListComanda' %}active{% endif %}" href="{% url 'ListComanda' %}?sort_by=id_comanda&sort_order=ASC">Comanda</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'ListProdus' %}active{% endif %}" href="{% url 'ListProdus' %}?sort_by=id_produs&sort_order=ASC">Produs_stoc</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'ListFirma' %}active{% endif %}" href="{% url 'ListFirma' %}?sort_by=id_firma&sort_order=ASC">Firma</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'ListALTL' %}active{% endif %}" href="{% url 'ListALTL' %}?sort_by=data&sort_order=DESC">Angajat_lucreaza</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'ListProgram_tir' %}active{% endif %}" href="{% url 'ListProgram_tir' %}?sort_by=iesire&sort_order=DESC">Program_tir</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'ListTransport' %}active{% endif %}" href="{% url 'ListTransport' %}?sort_by=distanta&sort_order=DESC">Transport</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if current_view == 'ListProduse_comanda' %}active{% endif %}" href="{% url 'ListProduse_comanda' %}?sort_by=nr_paleti&sort_order=DESC">Produse_comanda</a>
              </li>
            </ul>
            <button id="scrollRight" class="scroll-button">&gt;</button>
          </div>
        </div>
        {% else %}
        <div class="navbar-nav-wrapper">
          <ul id="navList" class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link {% if current_view == 'TirList' %}active{% endif %}" href="{% url 'TirList' %}?sort_by=id_tir&sort_order=ASC">Tir</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if current_view == 'ListPoarta' %}active{% endif %}" href="{% url 'ListPoarta' %}?sort_by=id_poarta&sort_order=ASC">Poarta</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if current_view == 'ListComanda' %}active{% endif %}" href="{% url 'ListComanda' %}?sort_by=id_comanda&sort_order=ASC">Comanda</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if current_view == 'ListProdus' %}active{% endif %}" href="{% url 'ListProdus' %}?sort_by=id_produs&sort_order=ASC">Produs_stoc</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if current_view == 'ListFirma' %}active{% endif %}" href="{% url 'ListFirma' %}?sort_by=id_firma&sort_order=ASC">Firma</a>
            </li>
          </ul>
        </div>
        {% endif %}
        &nbsp;&nbsp;
        <div class="search-container d-flex align-items-center">
          <form class="d-flex ml-2" id="searchForm">
            <input class="form-control me-sm-2" type="search" placeholder="Search by..." id="searchInput" style="width:16vw;">
          </form>
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="searchButton" data-bs-toggle="dropdown" aria-expanded="false">
              Select column
            </button>
            <ul class="dropdown-menu" aria-labelledby="searchButton">
              {% for column in search_columns %}
              <li><a class="dropdown-item" href="#" data-value="{{ column }}">
                  {{ column }}</a></li>
              {% endfor %}
            </ul>
          </div>
        </div>

      </div>
      <div class="welcome-container d-flex align-items-center ms-3">
        <span class="welcome-message">Welcome,
          {{ user.username }}</span>
        {% if user.is_superuser %}
        <a href="{% url 'admin:index' %}" class="btn btn-outline-light ms-2">Admin</a>
        {% endif %}
        <a href="{% url 'logout' %}" class="btn btn-outline-light ms-2">Logout</a>
      </div>
    </div>


</nav>

<script>
  document.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', function() {
      document.getElementById('searchButton').innerText = this.innerText;
    });
  });


  const scrollAmount = 500; // Adjust this value for scroll distance
  const navList = document.getElementById('navList');

  // Save the scroll position when clicking a link
  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', () => {
      localStorage.setItem('scrollPosition', navList.scrollLeft);
    });
  });

  // Restore the scroll position after the page reloads
  window.addEventListener('load', () => {
    const scrollPosition = localStorage.getItem('scrollPosition');
    if (scrollPosition) {
      navList.scrollLeft = scrollPosition;
      localStorage.removeItem('scrollPosition'); // Clear the saved position after using it
    }
  });

  // Scroll buttons functionality
  document.getElementById('scrollLeft').addEventListener('click', () => {
    navList.scrollBy({
      left: -scrollAmount,
      behavior: 'smooth'
    });
  });

  document.getElementById('scrollRight').addEventListener('click', () => {
    navList.scrollBy({
      left: scrollAmount,
      behavior: 'smooth'
    });
  });

  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
      var messagesDiv = document.querySelector('.messages');
      if (messagesDiv) {
        messagesDiv.style.display = 'none';
      }
    }, 3000);
  });
</script>

{% endwith %}

{% if messages %}
<div class="messages">
  {% for message in messages %}
  <div class="{% if message.tags %}alert alert-{{ message.tags }}{% endif %}">
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    {{ message }}
  </div>
  {% endfor %}
</div>

{% endif %}

<style>
  .welcome-container {
    display: flex;
    align-items: center;
    margin-left: 1em;
  }

  .search-container {
    display: flex;
    align-items: center;
  }

  .navbar-nav {
    display: flex;
    overflow: hidden;
    width: 85%;
    position: relative;
    flex-wrap: nowrap;
    margin-left: 1em;
    margin-right: 1em;
    /* Prevent items from wrapping to the next line */
  }

  .navbar-nav-wrapper {
    display: flex;
    position: relative;
    width: 1em;
    margin-left: 1em;
  }

  .navbar-nav .nav-item {
    flex: 0 0 auto;
  }

  .scroll-button {
    display: flex;
    background: none;
    border: none;
    color: white;
    font-size: 1.5em;
    cursor: pointer;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
  }

  #scrollLeft {
    left: 5.2em;
  }

  #scrollRight {
    right: 1em;
  }

  .navbar-nav-wrapper {
    display: flex;
    overflow: hidden;
    flex: 1;
  }

  .navbar-nav {
    display: flex;
    transition: transform 0.3s ease;
  }

  .nav-item {
    flex: 0 0 auto;
  }

  .scroll-button {
    background: none;
    border: none;
    color: white;
    font-size: 1.5em;
    cursor: pointer;
    padding: 0 10px;
    z-index: 2;
  }

  .scroll-container {
    display: flex;
    align-items: center;
    width: 50%;
  }

  #searchButton {
    padding: 0.375rem 1rem;
    margin-left: 10px;
  }

  /* Optional: Adjust the dropdown menu to fit the button width */
  .dropdown-menu {
    width: auto;
    min-width: 100px;
  }

  /* Adjust as needed */
</style>